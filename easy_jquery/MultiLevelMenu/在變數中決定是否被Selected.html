<!DOCTYPE html>
<html>
<head>
<title>基本 MultiLevelMenu 在變數時，就給他決定誰被selected</title>
<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="css/style.css">
<link type="text/css" rel="stylesheet" href="css/extend.css">
<link type="text/css" rel="stylesheet" href="css/all.css">
<link type="text/css" rel="stylesheet" href="css/font-awesome.min.css">


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!--<script src="js/bootstrap.min.js"></script>
<script src="js/customs-dist.js"></script>
<script src="js/custom-common.js"></script>
<script src="js/libs-dist.js"></script>
<script src="js/def-component-half-selectMenu.js"></script>
<script src="js/custom-multi-level-menu.js"></script>-->
<script src="js/libs-dist.js"></script>
</head>
<body>

    <div class="input-group-text pseudo-dropdown-field" data-menu-target="#test1">較進階，有篩選的功能</div>

    <!--第一種：較進階的(有篩選功能的)-->
    <div class="special-menu special-overlay-menu" id="test1">
            <div class="card">
                <div class="card-header">
                    <i class="special-menu-close-link fa fa-times pull-right"></i>
                    <h2>選擇測試號碼</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <div id="test"></div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <a class="btn btn-default special-menu-close-link" style="border:1px solid gray;" href="javascript:;">取消</a>
                    <a class="btn btn-dark  special-menu-close-link" href="javascript:;">確定</a>
                </div>
            </div>
        </div>

    <script>
        // 要給他的資料 有要4個屬性 (可以不必每個都給，但text 和 value 一定要有)
        // 如果要好幾層的話， children 要放 其 child 的陣列 (而 child 裡面也是 基本)
        var data = [
            {
                text : '測試一',
                value : 1,
                desc : '00385',
                children : [],
                selected : true
            },
            {
                text : '測試二',
                value : 2,
                desc : '00386',
                children : [],
                selected : true
            },
            {
                text : '測試三',
                value : 3,
                desc : '00485',
                children : [],
                readOnly : true
            },
            {
                text : '測試四',
                value : 4,
                desc : '00785',
                children : []
            }
        ];

        // 上面是資料(如果今天是用 ajax 取回來的，要記得儲存)
        // 因為 他取的value只能取到最後一層的 => 故2層以上的話，第一層的value是取不到的 => 所以要記原值才能找到值

        // 給資料 (記得都要用 $(document).ready()來給，後面的也都是)
        $(document).ready(function () {
                    $('#test').multiLevelMenu({
                        depth: 1,  //共有幾層
                        fields: ['測試表'],  //上面標頭顯示文字(有幾層就有幾個)
                        data: data,  // 給的資料
                        multiple: true,  // 是否可以多選
                        selected: true,   // 會出現已選擇的項目  這個框
                        search: true,    // 是否可以搜尋 (會用 text 和 desc 來查)
                        cross: false,     // 是否有 "全部" 選項
                        searchtext: '關鍵字',
                        searchDesc: '可輸入測試號碼'  
                    });
        })
    </script>

    <!------------------------------------------------------------------------------------------------------------------------------>

    <!--基本型-->

    <div class="input-group-text pseudo-dropdown-field" data-menu-target="#test2">基本(有children的)</div>

    <!--第二種：較基本的-->
    <div class="special-menu special-overlay-menu" id="test2">
            <div class="card">
                <div class="card-header">
                    <i class="special-menu-close-link fa fa-times pull-right"></i>
                    <h2>選擇測試號碼</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <div id="testDiv"></div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <a class="btn btn-default special-menu-close-link" style="border:1px solid gray;" href="javascript:;">取消</a>
                    <a class="btn btn-dark  special-menu-close-link" href="javascript:;">確定</a>
                </div>
            </div>
        </div>

    <script>

        // 要給他的資料 有要4個屬性 (可以不必每個都給，但text 和 value 一定要有)
        // 如果要好幾層的話， children 要放 其 child 的陣列 (而 child 裡面也是 基本)
        var data2 = [
            {
                text : '測試一',
                value : 1,
                children : [
                    {
                        text : '測試1-1',
                        value : 1.1,
                        children : []
                    }
                ],
                selected : true
            },
            {
                text : '測試二',
                value : 2,
                children : [
                    {
                        text : '測試2-1',
                        value : 2.1,
                        children : []
                    }
                ]
            }
        ];

        // 上面是資料(如果今天是用 ajax 取回來的，要記得儲存)
        // 因為 他取的value只能取到最後一層的 => 故2層以上的話，第一層的value是取不到的 => 所以要記原值才能找到值

        // 給資料 (記得都要用 $(document).ready()來給，後面的也都是)
        $(document).ready(function () {
                    $('#testDiv').multiLevelMenu({
                        depth: 2,  //共有幾層
                        fields: ['測試表', '子測試表'],  //上面標頭顯示文字(有幾層就有幾個)
                        data: data2,  // 給的資料
                        multiple: false,  // 是否可以多選  
                    });
        })
    </script>

    <!--
        注意： 目前會有些Bug ， 我也不知道是為何
        就是明明是2層，卻按完第一層後會跳到第3層
        解決方法： 以下方法

        現在是好了，可以拿掉了 => 應該是上面多載到其他的js去影響到了
    -->
    <script>
            setInterval(function () {
                $('#testDiv').find(".multi-level-menu-container").map(function (index, ele) {
                     //明明depth就是2，卻莫名可以到第3頁，這真的不了解 (level從0開始是第一頁，level=1是第二頁，level=2是第三頁，但完全不會有第三頁才對)
                     //所以強制把他拉回第二頁
                     //data-current-level 是目前在第幾層 (從0開始 => 第一層是0)
                    if (parseInt($(ele).attr("data-current-level")) >= 2) {
                        $(ele).attr("data-current-level", "1");
                    }
                })
            }, 100);
    </script>


</body>
</html>