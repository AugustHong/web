<!DOCTYPE html>
<html>
<head>
<title>MultiLevelMenu 清空成初使狀態</title>
<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
<link type="text/css" rel="stylesheet" href="css/style.css">
<link type="text/css" rel="stylesheet" href="css/extend.css">
<link type="text/css" rel="stylesheet" href="css/all.css">
<link type="text/css" rel="stylesheet" href="css/font-awesome.min.css">


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!--<script src="js/bootstrap.min.js"></script>
<script src="js/customs-dist.js"></script>
<script src="js/custom-common.js"></script>
<script src="js/libs-dist.js"></script>
<script src="js/def-component-half-selectMenu.js"></script>
<script src="js/custom-multi-level-menu.js"></script>-->
<script src="js/libs-dist.js"></script>
</head>
<body>

    <div class="input-group-text pseudo-dropdown-field" data-menu-target="#test1" id="t1">較進階，有篩選的功能</div>

    <!--第一種：較進階的(有篩選功能的)-->
    <div class="special-menu special-overlay-menu" id="test1">
            <div class="card">
                <div class="card-header">
                    <i class="special-menu-close-link fa fa-times pull-right"></i>
                    <h2>選擇測試號碼</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <div id="test"></div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <a class="btn btn-default special-menu-close-link" style="border:1px solid gray;" href="javascript:;">取消</a>
                    <a class="btn btn-dark  special-menu-close-link" href="javascript:;" onclick="SettingData();">確定</a>
                </div>
            </div>
        </div>

        <button type="button" onclick="Reset();">進階回初使狀態</button>

    <script>
        // 預設值
        var defaultData = ['測試一', '測試四'];

        // 要給他的資料 有要4個屬性 (可以不必每個都給，但text 和 value 一定要有)
        // 如果要好幾層的話， children 要放 其 child 的陣列 (而 child 裡面也是 基本)
        var data = [
            {
                text : '測試一',
                value : 1,
                desc : '00385',
                children : []
            },
            {
                text : '測試二',
                value : 2,
                desc : '00386',
                children : []
            },
            {
                text : '測試三',
                value : 3,
                desc : '00485',
                children : []
            },
            {
                text : '測試四',
                value : 4,
                desc : '00785',
                children : []
            }
        ];

        // 上面是資料(如果今天是用 ajax 取回來的，要記得儲存)
        // 因為 他取的value只能取到最後一層的 => 故2層以上的話，第一層的value是取不到的 => 所以要記原值才能找到值

        // 給資料 (記得都要用 $(document).ready()來給，後面的也都是)
        $(document).ready(function () {
                    $('#test').multiLevelMenu({
                        depth: 1,  //共有幾層
                        fields: ['測試表'],  //上面標頭顯示文字(有幾層就有幾個)
                        data: data,  // 給的資料
                        multiple: true,  // 是否可以多選
                        selected: true,   // 會出現已選擇的項目  這個框
                        search: true,    // 是否可以搜尋 (會用 text 和 desc 來查)
                        cross: false,     // 是否有 "全部" 選項
                        searchtext: '關鍵字',
                        searchDesc: '可輸入測試號碼'  
                    });
        })
    </script>

        <!--取值-->
        <script>
                function SettingData(){
                    // 其本上就是找底下 的 li 中 class 有 active 的
                    // 不過上面所講的是基本的，這邊進階的有幾個不同
        
                    /*
                        1. 如果是 selected : true 的 會有個 class 為 selected-list 的 ul (選你勾選到的) => 故直接拿 .find("li.active") 會去到2次
                            => 改成 .find(".menu-list").find("li.active")
        
                        2. 如果有 desc 的 => 要取值的話要變成 
                        .find("li.active").find(".item-text").map(function(index, ele){
                            var d = ele.innerHTML.split("<br>");
                            // d[0] = text ； d[1] = desc
                        })
        
                        3. 如果是2層以上(因為 只有最底層取得到value => 故要用 index 再去找其值 --> 這部份在下方會說到)
                    */
        
                    var result = [];
        
                    // 這裡的符合 第1、2點
                    // 因為 第一點的關系 要特別 .find(".menu-list")
                    $('#test').find(".menu-list").find("li.active").find(".item-text").map(function(index, ele){
                            var d = ele.innerHTML.split("<br>");
                            // d[0] = text ； d[1] = desc  // 因為 第二點的關系 ： 所以要特別 .find(".item-text") 再用 <br> 分開
                            result.push(d[0]);
                    })
        
                    $("#t1").html(result.join("、"));
                }
            </script>

    <!--清空成最初使狀態-->
    <script>
        function Reset(){

            // 清空 (直接去找 總輸出 (有多選的會有個目前已選的項目)， 去那邊把每個按一遍，就會清掉了) => 但要每筆跑(所以要先取到筆數)
            var len = $('#test').find(".selected-list").find("li").length;

            for(var i = 0; i < len; i++){
                $('#test').find(".selected-list").find("li").click();
            }

            $("#t1").html("較進階，有篩選功能");

            // 如果有預設值的 ， 清完後 ，這邊可以再寫一次 給預設值的 程式 即可
        }
    </script>

    <!------------------------------------------------------------------------------------------------------------------------------>

    <!--基本型-->

    <div class="input-group-text pseudo-dropdown-field" data-menu-target="#test2" id="t2">基本(有children的)</div>

    <!--第二種：較基本的-->
    <div class="special-menu special-overlay-menu" id="test2">
            <div class="card">
                <div class="card-header">
                    <i class="special-menu-close-link fa fa-times pull-right"></i>
                    <h2>選擇測試號碼</h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <div id="testDiv"></div>
                        </div>
                    </div>
                </div>
                <div class="card-footer text-center">
                    <a class="btn btn-default special-menu-close-link" style="border:1px solid gray;" href="javascript:;">取消</a>
                    <a class="btn btn-dark" href="javascript:;" onclick="SettingData2();">確定</a>
                </div>
            </div>
        </div>

        <button type="button" onclick="Reset2();">基本清空成初使狀態</button>

    <script>

        var defaultData2 = ['測試一' , '測試1-1']

        // 要給他的資料 有要4個屬性 (可以不必每個都給，但text 和 value 一定要有)
        // 如果要好幾層的話， children 要放 其 child 的陣列 (而 child 裡面也是 基本)
        var data2 = [
            {
                text : '測試一',
                value : 1,
                children : [
                    {
                        text : '測試1-1',
                        value : 1.1,
                        children : []
                    }
                ]
            },
            {
                text : '測試二',
                value : 2,
                children : [
                    {
                        text : '測試2-1',
                        value : 2.1,
                        children : []
                    }
                ]
            }
        ];

        // 上面是資料(如果今天是用 ajax 取回來的，要記得儲存)
        // 因為 他取的value只能取到最後一層的 => 故2層以上的話，第一層的value是取不到的 => 所以要記原值才能找到值

        // 給資料 (記得都要用 $(document).ready()來給，後面的也都是)
        $(document).ready(function () {
                    $('#testDiv').multiLevelMenu({
                        depth: 2,  //共有幾層
                        fields: ['測試表', '子測試表'],  //上面標頭顯示文字(有幾層就有幾個)
                        data: data2,  // 給的資料
                        multiple: false,  // 是否可以多選  
                    });
        })
    </script>

<script>
        // 基本上大部份的用這個即可，少部份才會用到上面的(而且上面的我也還沒全部研究完整)
        function SettingData2(){

            var resultIndex = [];  //取到的index
            var resultValue = []; // 要透過 index 得到的value值
            var result = [];  // 得到的文字

            $("#testDiv").find("li.active").map(function(index, ele){
                resultIndex.push(ele.dataset.index);
                result.push(ele.innerText);
            })

            // 這邊也可以設定 至少選到哪
            if (result.length > 1){
                // 得到 value 值
                resultValue.push(data2[resultIndex[0]].value);
                // 因為上面有設一定要取到第二層 ， 不然要判斷 ，否則容易炸掉
                resultValue.push(data2[resultIndex[0]].children[resultIndex[1]].value); 
                
                $("#t2").html(result.join("/"));
                alert("取到的 value 值 為 ：" + resultValue.join(" "));

                // 讓他關閉
                $("#test2").removeClass("show");

            }else{
                alert("請至少選到 子測試 (即第二層)");
            }

        }
    </script>


<!--清空成初使狀態-->
<script>
    function Reset2(){

        // 有階層的，要先幫他按到第一層
        $("#testDiv").find(".back-item")[0].click();
        $("#testDiv").find(".back-item")[0].click();

        // 清空
        $("#testDiv").find("li.active").map(function(index, ele){
            $(ele).removeClass("active");
        })

        $("#t2").html("");

        // 如果有預設值的 ， 清完後 ，這邊可以再寫一次 給預設值的 程式 即可
    }
    </script>


</body>
</html>